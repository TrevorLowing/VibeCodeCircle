# Cursor Development Rules - Vibe Code Deploy Plugin

**Project:** Vibe Code Deploy WordPress Plugin  
**Purpose:** Enforce WordPress plugin development best practices and coding standards  
**Last Updated:** 2025

---

## WordPress Plugin Development Standards

### Required Standards

All code must follow **WordPress Plugin Development Best Practices**:

- **Reference**: See `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md` for comprehensive guidelines
- **WordPress Plugin Handbook**: https://developer.wordpress.org/plugins/
- **WordPress Coding Standards**: https://developer.wordpress.org/coding-standards/

### Plugin Lifecycle Hooks

**REQUIRED**: All plugins must implement proper activation, deactivation, and uninstall hooks.

- **Activation Hook**: Set default options, flush rewrite rules, schedule cron jobs
- **Deactivation Hook**: Clear scheduled events, flush rewrite rules
- **Uninstall Hook**: Delete options, transients, clean up database (preserve user data)

**Reference**: See `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md#plugin-lifecycle-hooks`

### Security Requirements

**ALWAYS**:
- Check `ABSPATH` at the top of all PHP files
- Use `current_user_can( 'manage_options' )` for admin pages
- Use `check_admin_referer()` or `wp_verify_nonce()` for form submissions
- Sanitize all input with WordPress functions (`sanitize_text_field()`, `sanitize_email()`, etc.)
- Escape all output with WordPress functions (`esc_html()`, `esc_attr()`, `esc_url()`)
- Use prepared statements for database queries

**Reference**: See `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md#security-best-practices`

### Code Organization

**File Structure**:
```
plugin-name/
├── plugin-name.php          # Main plugin file
├── uninstall.php            # Uninstall handler
├── includes/
│   ├── Bootstrap.php       # Plugin initialization
│   ├── Settings.php        # Settings management
│   ├── Services/           # Service classes
│   └── Admin/              # Admin pages
├── assets/
│   ├── css/
│   └── js/
└── tests/                  # Unit tests
```

**Namespace**: Use `VibeCode\Deploy` for core, `VibeCode\Deploy\Services` for services, `VibeCode\Deploy\Admin` for admin pages.

### PHP Standards

**WordPress PHP Coding Standards**:
- **Indentation**: Use tabs (not spaces)
- **Brace Style**: Opening brace on same line
- **Naming**: Use `snake_case` for functions, `PascalCase` for classes
- **Type Declarations**: Use type hints for parameters and return types (PHP 8.0+)
- **Visibility**: Always declare visibility (`public`, `private`, `protected`)
- **Final Classes**: Use `final` for service classes that shouldn't be extended

**Reference**: See `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md#wordpress-coding-standards`

### Internationalization (i18n)

**REQUIRED**: All user-facing strings must be translatable.

- Use text domain: `vibecode-deploy`
- Use WordPress translation functions: `__()`, `_e()`, `esc_html__()`, `esc_html_e()`
- Always escape translated output

**Reference**: See `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md#internationalization-i18n`

### Database Management

**REQUIRED**: Track database schema versions and handle upgrades.

- Use `dbDelta()` for table creation
- Track schema version in options
- Handle upgrades in activation hook or upgrade routine

**Reference**: See `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md#database-management`

### Admin UI Standards

**REQUIRED**: Follow WordPress admin UI standards.

- Use `wrap` class for page containers
- Use `form-table` for form layouts
- Use WordPress notice classes (`notice`, `notice-success`, `notice-error`, etc.)
- Use `submit_button()` for form submissions
- Use `get_admin_page_title()` for page titles

**Reference**: See `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md#admin-ui-standards`

### Performance

**REQUIRED**: Optimize for performance.

- Use WordPress transients for caching
- Optimize database queries (use `WP_Query` with appropriate parameters)
- Load assets only when needed
- Use lazy loading for images and scripts

**Reference**: See `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md#performance`

### Error Handling

**REQUIRED**: Use WordPress error handling patterns.

- Use `WP_Error` for errors
- Use `Logger::error()` for plugin-specific logging
- Use WordPress debug logging when `WP_DEBUG` is enabled

**Reference**: See `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md#error-handling`

### Testing

**REQUIRED**: Write automated tests for all critical functionality.

- Use PHPUnit with `WP_UnitTestCase`
- Test activation, deactivation, and uninstall hooks
- Test database operations
- Test REST API endpoints
- Test form validation and security

**Reference**: See `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md#testing`

## Code Standards

### PHP

- **PHP Version**: 8.0+ (required)
- **Type Declarations**: Use type hints for all parameters and return types
- **Visibility**: Use `public static` for service methods
- **Final Classes**: All service classes should be `final`
- **Namespace**: `VibeCode\Deploy` for core, `VibeCode\Deploy\Services` for services, `VibeCode\Deploy\Admin` for admin

### Documentation

- All public methods must have PHPDoc blocks
- Include parameter descriptions and return types
- Document exceptions that may be thrown
- Follow WordPress PHPDoc standards

### Security

- Always check `ABSPATH` at the top of files
- Use `current_user_can( 'manage_options' )` for admin pages
- Use `check_admin_referer()` for form submissions
- Sanitize all input with appropriate WordPress functions
- Escape all output with `esc_html()`, `esc_attr()`, `esc_url()`

## Prohibited Practices

### ❌ NEVER Do These

1. Skip activation/deactivation/uninstall hooks
2. Delete user data on deactivation (only on uninstall, and preserve by default)
3. Use `var` in JavaScript (use `const` or `let`)
4. Use `!important` in CSS (breaks WordPress frameworks)
5. Hardcode URLs or paths (use WordPress functions)
6. Skip input sanitization in PHP
7. Skip output escaping in PHP
8. Use deprecated WordPress functions
9. Skip capability checks for admin pages
10. Skip nonce verification for form submissions
11. Skip internationalization for user-facing strings
12. Skip automated tests for critical functionality

## Quick Reference

### Adding a New Service

1. Create file in `includes/Services/YourService.php`
2. Use namespace `VibeCode\Deploy\Services`
3. Make class `final`
4. Use `public static` methods
5. Add PHPDoc blocks
6. Check `ABSPATH` at top
7. Require in `Bootstrap.php`
8. Write unit tests

### Adding a New Admin Page

1. Create file in `includes/Admin/YourPage.php`
2. Use namespace `VibeCode\Deploy\Admin`
3. Make class `final`
4. Use `public static` methods
5. Check capabilities
6. Verify nonces
7. Escape output
8. Require in `Bootstrap.php`
9. Register in `init()` method

### Adding a New Hook

1. Use consistent naming: `vibecode_deploy_{event}`
2. Document hook in Developer Guide
3. Fire at appropriate time
4. Pass relevant data as parameters
5. Allow filtering of data with filters

---

For complete documentation, see:
- **Developer Guide**: `docs/DEVELOPER_GUIDE.md`
- **WordPress Plugin Best Practices**: `docs/WORDPRESS_PLUGIN_BEST_PRACTICES.md`
- **API Reference**: `docs/API_REFERENCE.md`
